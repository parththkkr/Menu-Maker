{% extends "base.html" %}
{% block content %}
<h1>Cart Items</h1>
{% if total_items > 0 %}
<ul>
  {% for item in cart_items %}
    <li>
      <strong>{{ item.itemObj.ItemName }}</strong> {{ item.quantity }} X ${{ item.itemObj.Price }}
    </li>
  {% endfor %}
</ul>
<p id="total_items">Total Items: {{ total_items }}</p>

<p id="total_cost">Total Cost: ${{ total_cost }}</p>


<form id="discount-form" data-total-cost="{{ total_cost }}">
  <label for="discount_code">Discount Code:</label>
  <input type="text" id="discount_code" name="discount_code" required>
  <button type="submit" id="apply_discount_btn">Apply Discount</button>
</form>

{% else %}
<p>Your cart is empty.</p>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('discount-form');
  const discountInput = document.getElementById('discount_code');
  const applyDiscountBtn = document.getElementById('apply_discount_btn');
  const totalCost = parseFloat(form.dataset.totalCost); // Parse the total cost from the data attribute

  form.addEventListener('submit', function(event) {
    event.preventDefault();
    const discountCode = discountInput.value.trim();

    if (discountCode === 'DISCOUNT10') {
      const discountAmount = totalCost * 0.1; // 10% discount
      const discountedTotal = totalCost - discountAmount;

      document.getElementById('total_cost').textContent = `Total Cost: $${discountedTotal.toFixed(2)}`;

      alert(`Discount applied successfully! You saved $${discountAmount.toFixed(2)}. Your new total is $${discountedTotal.toFixed(2)}.`);
    } else {
      alert('Invalid discount code. Please try again.');
      document.getElementById('total_cost').textContent = `Total Cost: $${totalCost.toFixed(2)}`;
    }
  });
});
</script>
{% endblock %}
